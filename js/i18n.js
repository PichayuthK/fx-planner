(function () {
  const STORAGE_KEY = "fx-locale";

  const STRINGS = {
    en: {
      appTitle: "Forex Plan",
      appSubtitle: "Growth projection & trading journal",
      tabThisWeek: "This week",
      tabTradeHistory: "Trade History",
      tabProjection: "Projection",
      settingsExportJson: "Export Data (JSON)",
      settingsImportJson: "Import Data (JSON)",
      settingsExportCsv: "Export Trade History (CSV)",
      settingsLightMode: "Light Mode",
      settingsDarkMode: "Dark Mode",
      settingsInstallApp: "Install app",
      settingsClearData: "Clear All Data",
      addTrade: "Add Trade",
      win: "Win",
      loss: "Loss",
      amount: "Amount",
      tpPts: "TP pts",
      slPts: "SL pts",
      date: "Date",
      add: "Enter",
      note: "Note",
      notePlaceholder: "e.g. breakout, news scalp…",
      thisWeekTrades: "This Week's Trades",
      overviewEmpty: "No projection yet. Head to the **Projection** tab to set up your plan.",
      overviewEmptyLink: "Projection",
      goalToday: "Today",
      goalThisWeek: "This week",
      lotThisWeek: "Lot to use",
      lotThisWeekTip: "Max lot size for each trade for this week based on your current capital and risk settings.",
      done: "✓ Done",
      pts: "pts",
      currentCapital: "Current Capital",
      currentCapitalTip: "Initial capital + total P&L from all logged trades.",
      startedAt: "started at",
      pnlThisWeek: "P&L (this week)",
      pnlThisWeekTip: "Sum of trades for this week.",
      trades: "trades",
      trade: "trade",
      tableDate: "Date",
      tableResult: "Result",
      tableAmount: "Amount",
      tableLot: "Lot",
      tablePoints: "Points",
      tableSl: "SL",
      tableNote: "Note",
      delete: "Delete",
      projectionTitle: "Port Growth Projection",
      projectionSubtitle: "Estimate how many weeks to reach your daily earning target",
      projectionExplainerTemplate: "You will start your journey with the initial capital of {{capital}} and you are comfortable to take a risk of {{riskPct}}% for each trade ({{riskDollar}}). Based on your experience, your technique has a {{winRate}}% win rate.\n\nYour daily plan is to trade at least {{maxTradesPerDay}} time(s), and for each trade you plan to have {{tpPoints}} take profit points and {{slPoints}} stop loss points. That means your daily point goal is {{dailyGoalPts}} points (times to trade × TP points).\n\nYour goal is to earn {{targetPerDay}} per day. With this steady growth you will reach your goal in {{weeksToGoal}}.",
      projectionExplainerWeeksPlaceholder: "— (calculate to see)",
      initialSetup: "Initial Setup",
      dailyPlan: "Daily Plan",
      endGoal: "End Goal",
      capital: "Capital",
      riskPerOrder: "Risk per order",
      expectedWinRate: "Expected win rate",
      tpPointsPerOrder: "TP points per trade",
      slPointsPerOrder: "SL points per trade",
      maxTradesPerDay: "Max trades / day",
      commission: "Commission",
      netGain: "P/L",
      totalTargetPts: "Total target points",
      totalTargetPtsTip: "TP points per order × max trades per day. Total points you aim to capture per day.",
      ptsPerDay: "pts/day",
      targetEarningsPerDay: "Target earnings / day",
      calculateProjection: "Calculate Projection",
      capitalGrowth: "Capital Growth",
      weeklyBreakdown: "Weekly Breakdown",
      equityCurve: "Equity Curve",
      week: "Week",
      weekUnit: "week",
      weeksUnit: "weeks",
      riskDollar: "Risk $",
      maxLot: "Max Lot",
      dailyTarget: "Daily Target",
      weekPnl: "Week P&L",
      endCapital: "End Capital",
      weeksToGoal: "Weeks to goal",
      maxLotFinal: "Max lot (final)",
      finalCapital: "Final capital",
      perOrder: "per order",
      projected: "projected",
      dayTarget: "/day target",
      noTradesThisPeriod: "No trades this period",
      allTime: "All Time",
      pnlAllTime: "(all time)",
      pnlThisWeekShort: "(this week)",
      winRate: "Win rate",
      rrRatio: "R : R ratio",
      onTrack: "On track",
      behind: "Behind",
      vsProjected: "vs projected",
      confirmDeleteTrade: "Delete this trade?",
      confirmClearData: "Delete ALL data? This cannot be undone.\n\nProjection, trading logs, and settings will be permanently removed.",
      importSuccess: "Data imported successfully!",
      importInvalid: "Invalid backup file.",
      exportNoLogs: "No trading logs to export.",
      compareError: "Could not compare to projection.",
      youAreHere: "← You",
    },
    th: {
      appTitle: "Forex Plan",
      appSubtitle: "แผนการเติบโตและบันทึกเทรด",
      tabThisWeek: "สัปดาห์นี้",
      tabTradeHistory: "ประวัติเทรด",
      tabProjection: "แผนการ",
      settingsExportJson: "ส่งออกข้อมูล (JSON)",
      settingsImportJson: "นำเข้าข้อมูล (JSON)",
      settingsExportCsv: "ส่งออกประวัติเทรด (CSV)",
      settingsLightMode: "โหมดสว่าง",
      settingsDarkMode: "โหมดมืด",
      settingsInstallApp: "ติดตั้งแอป",
      settingsClearData: "ลบข้อมูลทั้งหมด",
      addTrade: "เพิ่มเทรด",
      win: "กำไร",
      loss: "ขาดทุน",
      amount: "จำนวนเงิน",
      tpPts: "TP จุด",
      slPts: "SL จุด",
      date: "วันที่",
      add: "+ เพิ่ม",
      note: "หมายเหตุ",
      notePlaceholder: "เช่น breakout, ข่าว…",
      thisWeekTrades: "เทรดสัปดาห์นี้",
      overviewEmpty: "ยังไม่มีแผน ไปที่แท็บ **แผนการ** เพื่อตั้งค่า",
      overviewEmptyLink: "แผนการ",
      goalToday: "วันนี้",
      goalThisWeek: "สัปดาห์นี้",
      lotThisWeek: "Lot ที่ควรใช้",
      lotThisWeekTip: "Lot สูงสุดที่ควรใช้ต่อการเทรด สำหรับสัปดาห์นี้ตามทุนปัจจุบันและความเสี่ยงที่ตั้งไว้",
      done: "✓ ทำแล้ว",
      pts: "จุด",
      currentCapital: "ทุนปัจจุบัน",
      currentCapitalTip: "ทุนเริ่มต้น + ผลรวม P&L จากเทรดทั้งหมด",
      startedAt: "เริ่มที่",
      pnlThisWeek: "P&L (สัปดาห์นี้)",
      pnlThisWeekTip: "ผลรวมเทรดในสัปดาห์นี้",
      trades: "เทรด",
      trade: "เทรด",
      tableDate: "วันที่",
      tableResult: "ผล",
      tableAmount: "เงิน",
      tableLot: "Lot",
      tablePoints: "จุด",
      tableSl: "SL",
      tableNote: "หมายเหตุ",
      delete: "ลบ",
      projectionTitle: "แผนการเติบโตพอร์ต",
      projectionSubtitle: "ประเมินว่าจะใช้กี่สัปดาห์ถึงเป้ารายวัน",
      projectionExplainerTemplate: "คุณจะเริ่มด้วยทุนเริ่มต้น {{capital}} และยอมรับความเสี่ยง {{riskPct}}% ต่อเทรด ({{riskDollar}}) จากประสบการณ์ เทคนิคของคุณมีอัตราชนะ {{winRate}}%\n\nแผนรายวันคือเทรดอย่างน้อย {{maxTradesPerDay}} ครั้ง และแต่ละเทรดตั้งเป้า TP {{tpPoints}} จุด และ SL {{slPoints}} จุด นั่นคือเป้าจุดรายวัน {{dailyGoalPts}} จุด (จำนวนเทรด × จุด TP)\n\nเป้าคือหารายได้ {{targetPerDay}} ต่อวัน ด้วยการเติบโตแบบนี้คุณจะถึงเป้าใน {{weeksToGoal}}",
      projectionExplainerWeeksPlaceholder: "— (กดคำนวณเพื่อดู)",
      initialSetup: "ตั้งค่าเริ่มต้น",
      dailyPlan: "แผนรายวัน",
      endGoal: "เป้าหมายสุดท้าย",
      capital: "ทุน",
      riskPerOrder: "ความเสี่ยงต่อออเดอร์",
      expectedWinRate: "อัตราชนะที่คาด",
      tpPointsPerOrder: "TP จุดต่อเทรด",
      slPointsPerOrder: "SL จุดต่อเทรด",
      maxTradesPerDay: "เทรดสูงสุด / วัน",
      commission: "ค่าคอมมิชชัน",
      netGain: "P/L",
      totalTargetPts: "เป้าจุดรวม",
      totalTargetPtsTip: "TP จุด × จำนวนเทรดสูงสุดต่อวัน คือจุดที่ตั้งเป้าทั้งวัน",
      ptsPerDay: "จุด/วัน",
      targetEarningsPerDay: "เป้ารายได้ / วัน",
      calculateProjection: "คำนวณแผน",
      capitalGrowth: "การเติบโตของทุน",
      weeklyBreakdown: "รายสัปดาห์",
      equityCurve: "เส้น equity",
      week: "สัปดาห์",
      weekUnit: "สัปดาห์",
      weeksUnit: "สัปดาห์",
      riskDollar: "ความเสี่ยง $",
      maxLot: "Lot สูงสุด",
      dailyTarget: "เป้ารายวัน",
      weekPnl: "P&L สัปดาห์",
      endCapital: "ทุนสิ้นสัปดาห์",
      weeksToGoal: "สัปดาห์ถึงเป้า",
      maxLotFinal: "Lot สูงสุด (สุดท้าย)",
      finalCapital: "ทุนสุดท้าย",
      perOrder: "ต่อออเดอร์",
      projected: "ตามแผน",
      dayTarget: "เป้า/วัน",
      noTradesThisPeriod: "ไม่มีเทรดในช่วงนี้",
      allTime: "ทั้งหมด",
      pnlAllTime: "(ทั้งหมด)",
      pnlThisWeekShort: "(สัปดาห์นี้)",
      winRate: "อัตราชนะ",
      rrRatio: "อัตรา R : R",
      onTrack: "ตามแผน",
      behind: "ล้าหลัง",
      vsProjected: "เทียบแผน",
      confirmDeleteTrade: "ลบเทรดนี้?",
      confirmClearData: "ลบข้อมูลทั้งหมด? การกระทำนี้ไม่สามารถย้อนกลับได้\n\nแผนการ เทรด และการตั้งค่าจะถูกลบถาวร",
      importSuccess: "นำเข้าข้อมูลสำเร็จ!",
      importInvalid: "ไฟล์สำรองไม่ถูกต้อง",
      exportNoLogs: "ไม่มีประวัติเทรดให้ส่งออก",
      compareError: "เปรียบเทียบกับแผนไม่ได้",
      youAreHere: "← คุณ",
    },
  };

  ForexPlan.STRINGS = STRINGS;
  ForexPlan.locale = localStorage.getItem(STORAGE_KEY) || "en";
  document.documentElement.lang = ForexPlan.locale === "th" ? "th" : "en";

  ForexPlan.t = function (key) {
    const loc = STRINGS[ForexPlan.locale];
    const s = loc && loc[key];
    return s != null ? s : (STRINGS.en[key] != null ? STRINGS.en[key] : key);
  };

  ForexPlan.setLocale = function (code) {
    if (!STRINGS[code]) return;
    ForexPlan.locale = code;
    localStorage.setItem(STORAGE_KEY, code);
    document.documentElement.lang = code === "th" ? "th" : "en";
    if (typeof window.dispatchEvent === "function") {
      window.dispatchEvent(new CustomEvent("forexplan-locale-change"));
    }
  };

  ForexPlan.applyStaticTranslations = function () {
    document.querySelectorAll("[data-i18n]").forEach((el) => {
      const key = el.getAttribute("data-i18n");
      if (key) el.textContent = ForexPlan.t(key);
    });
    document.querySelectorAll("[data-i18n-ph]").forEach((el) => {
      const key = el.getAttribute("data-i18n-ph");
      if (key) el.placeholder = ForexPlan.t(key);
    });
  };
})();
